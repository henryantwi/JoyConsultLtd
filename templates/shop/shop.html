{% extends 'base.html' %}

{% load static %}

{% block title %}Joy Consult - Shop with Us {% endblock %}

{% block content %}
<!-- Start Hero Section -->
<div class="hero">
    <div class="container">
        <div class="row justify-content-between">
            <div class="col-lg-5">
                <div class="intro-excerpt">
                    <h1>Shop With Us</h1>
                </div>
            </div>
            <div class="col-lg-7">
                <!-- Additional content can be added here -->
            </div>
        </div>
    </div>
</div>
<!-- End Hero Section -->

<div class="untree_co-section product-section before-footer-section">
    <div class="container">
        <div class="row">

            {% for product in products %}
                <div class="col-12 col-md-4 col-lg-3 mb-5">
                    <a class="product-item" href="#">
                        <img src="{{ product.image.url }}" class="img-fluid product-thumbnail" alt="{{ product.name }}">
                        <h3 class="product-title">{{ product.name }}</h3>
                        <strong class="product-price">Ghc {{ product.price }}</strong>

                        <span class="icon-cross plus-button" data-product-id="{{ product.id }}">
                            <img src="{% static 'images/cross.svg' %}" class="img-fluid" alt="Cross Icon">
                        </span>
                    </a>
                </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
$(document).ready(function(){
    $('.plus-button').click(function(){
        var productId = $(this).data('product-id');
        var productQty = 1; // Assuming you're adding 1 quantity each time

        $.ajax({
            url: "{% url 'cart:cart_add' %}",
            type: 'POST',
            data: {
                productid: productId,
                productqty: productQty,
                csrfmiddlewaretoken: '{{ csrf_token }}',  // Ensure CSRF token is passed in the POST request
                action: 'post'
            },
            success: function(response){
                // Handle the response after successful addition
                // Example: Update the cart quantity display
                $('#cart-quantity').text(response.qty);
                alert("Product added to cart successfully!");
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText); // Provide error details for debugging
                alert("An error occurred while adding the product to the cart.");
            }
        });
    });
});
</script>
{% endblock %}
